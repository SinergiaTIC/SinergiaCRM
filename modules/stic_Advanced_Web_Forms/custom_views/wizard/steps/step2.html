<!-- Sidebar -->
<!--       data-attribute="x-on:change='TreeNavigator.toggleAllModules(step2.treeShowAllModules)'" -->
<nav class="wizard-sidebar bg-light border-end p-2 flex-shrink-0">
  <h3 x-text="utils.translate('LBL_RELATIONSHIPS')"></h3>
  <div
    id="jstree-loading"
    class="spinner-container justify-content-center align-items-center"
    x-show="step2.loadingTree"
  >
    <div class="spinner-border text-secondary" role="status"></div>
  </div>
  <div
    class="text-muted form-check form-switch"
    id="switch_TreeAllModules"
    data-model="step2.treeShowAllModules"
    data-label="LBL_SHOW_ALL_MODULES"
    data-attribute="x-on:change='TreeNavigator.toggleAllModules(step2.treeShowAllModules)'"
    x-init="sticControls.fieldCheckbox($el);"
    x-show="!step2.loadingTree"
  ></div>
  <div
    class="wizard-tree"
    id="jstree-container"
    x-init="$nextTick(() => {TreeNavigator.initializeModuleTree($('#jstree-container'));});"
    x-show="!step2.loadingTree"
  ></div>
</nav>

<!-- Main Panel -->
<main class="wizard-main flex-fill d-flex flex-column p-3">
  <!-- <div class="border rounded p-4 mb-5">
    <h3 class="mb-2" x-text="'[Elemento seleccionado]'"></h3>
    <h4 x-text="step2.treeSelectedData.text"></h4>
  </div> -->
  <div>
    <h3 class="mb-2" x-text="utils.translate('LBL_DATABLOCKS')"></h3>
    <div class="flex-fill border rounded p-2">
      <!-- Main Content -->
      <template x-for="(item, key) in formConfig.data_blocks">
        <div class="card" :x-data="{item: item, key: key}">
          <div class="card-body">
            <div class="card-title">
              <div class="d-flex justify-content-between">
                <h4
                  :id="'dataBlockTitleEdit-'+item.name"
                  data-model="item.text"
                  data-condition="item.editable_text"
                  x-init="sticControls.editableText($el);"
                ></h4>
                <template x-if="'required' in item && typeof item.required === 'function' && !item.required()">
                  <span class="btn suitepicon suitepicon-action-delete" @click="deleteDataBlock(key);"></span>
                </template>
              </div>
              <template x-if="item.module">
                <h5
                  class="text-muted"
                  x-text="utils.getModuleInformation(item.module).text + ' (' + item.name + ')'"
                ></h5>
              </template>
            </div>

            <div class="card-text">
              <!-- Fields Definition -->
              <div :id="'dataBlockFields'+item.name">
                [Los campos del Bloque de datos]
                <!-- Fields Details -->
                <div x-data="{ showDataFieldsTable: false}">
                  <div
                    class="text-muted form-check form-switch mt-3"
                    :id="'dataFieldsDetails'+item.name"
                    data-model="showDataFieldsTable"
                    data-label-text="[Mostrar Detalle]"
                    x-init="sticControls.fieldCheckbox($el);"
                  ></div>
                  <div class="card p-2 overflow-auto" x-show="showDataFieldsTable">
                    <div
                      class="mt-3"
                      :id="'dataFieldsTable'+item.name"
                      :data-objects="'item.fields'"
                      x-init="sticControls.elemTableObjects($el);"
                    ></div>
                  </div>
                </div>
              </div>
              <template x-if="item.module">
                <!-- Duplicate Definition -->
                <div :id="'dataBlockDuplicates'+item.name">
                  <div class="row">
                    <!-- Action -->
                    <div
                      class="col-3"
                      :id="'duplicateAction'+item.name"
                      :data-model="'item.duplicate_detection.on_duplicate'"
                      data-label="LBL_ONDUPLICATE_ACTION"
                      :data-map="utils.getList('stic_advanced_web_forms_datablocks_duplicate_action_list', true)"
                      x-init="sticControls.fieldSelect($el)"
                    ></div>
                    <!-- Fields -->
                    <div
                      class="col-9"
                      :id="'duplicateFields'+item.name"
                      :data-model="'item.duplicate_detection.fields'"
                      data-label="LBL_DUPLICATE_FIELDS"
                      :data-map="`utils.getModuleInformation('${item.module}').fields`"
                      data-map-property="text"
                      data-multiple
                      x-init="sticControls.fieldSelect($el)"
                    ></div>
                  </div>
                </div>
              </template>

              <!-- Accordion Headers -->
              <template x-if="item.module">
                <div
                  :id="'dataDef_'+item.name"
                  :data-sections="JSON.stringify([
                                    {headerText:`utils.translate('LBL_FIELDS') + ' ('+item.fields.length+')'`, selected:true, contentId:'dataBlockFields'+item.name},
                                    {headerText:`utils.translate('LBL_DUPLICATE_CHECK') + ' ('+item.duplicate_detection.fields.length+' - '+item.duplicate_detection.on_duplicate+')'`, selected:false, contentId:'dataBlockDuplicates'+item.name}
                                  ]);"
                  x-init="sticControls.accordion($el)"
                ></div>
              </template>
              <template x-if="!item.module">
                <div
                  :id="'dataDef_'+item.name"
                  :data-sections="JSON.stringify([
                                    {headerText:`utils.translate('LBL_FIELDS') + ' (' + item.fields.length +')'`, selected:true, contentId:'dataBlockFields'+item.name},
                                  ]);"
                  x-init="sticControls.accordion($el)"
                ></div>
              </template>
            </div>
          </div>
        </div>
      </template>

      <!-- Details Data [DEBUG] -->
      <div x-data="{ showDetails: false}">
        <div
          class="text-muted form-check form-switch mb-3 mt-5"
          id="showDetailsDataToggleSwitch"
          data-model="showDetails"
          data-label-text="[Mostrar Detalles]"
          x-init="sticControls.fieldCheckbox($el);"
        ></div>
        <div class="card p-2" x-show="showDetails">
          <!-- Relationships in Data Blocks -->
          <div id="detailsRelDataBlocks">
            <div
              class="mt-3"
              id="relDataBlocksTable"
              data-model="step2.relationshipsInDataBlocks"
              x-init="sticControls.elemTableArray($el);"
            ></div>
          </div>

          <!-- Modules in Data Blocks -->
          <div id="detailsModulesDataBlocks">
            <div
              class="mt-3"
              id="modulesDataBlocksTable"
              data-model="step2.modulesInDataBlocks"
              x-init="sticControls.elemTableArray($el);"
            ></div>
          </div>

          <!-- Data Blocks -->
          <div id="detailsDataBlocks">
            <div
              class="mt-3"
              id="dataBlocksTable"
              data-objects="formConfig.data_blocks"
              x-init="sticControls.elemTableObjects($el);"
            ></div>
          </div>

          <!-- Selected Node -->
          <div id="detailsSelectedNode">
            <div
              class="mt-3"
              id="selectedNodeTable"
              data-model="step2.treeSelectedData"
              x-init="sticControls.elemTableObject($el);"
            ></div>
          </div>

          <!-- Tab Headers -->
          <div
            id="details"
            :data-sections="JSON.stringify([
                          {headerText:`'[Relaciones en Bloques de datos]'`, selected:true, contentId:'detailsRelDataBlocks'},
                          {headerText:`'[MÃ³dulos en Bloques de datos]'`, selected:false, contentId:'detailsModulesDataBlocks'},
                          {headerText:`'[Bloques de datos]'`, selected:false, contentId:'detailsDataBlocks'},
                          {headerText:`'[Nodo seleccionado]'`, selected:false, contentId:'detailsSelectedNode'},
                        ]);"
            x-init="sticControls.tabs($el)"
          ></div>
        </div>
      </div>
    </div>
  </div>
</main>
