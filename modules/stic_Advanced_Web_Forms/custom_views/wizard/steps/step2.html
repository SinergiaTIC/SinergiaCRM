<!-- Main Panel -->
<main class="wizard-main flex-fill d-flex flex-column">
  <!-- Add DataBlock from Module -->
  <div
    class="border-bottom ps-3 pt-3 mb-2 bg-light"
    x-data="WizardStep2.addDataBlockModulexData(formConfig, step2);">
    <div class="d-flex mb-3">
      <button type="button" class="btn w-auto" x-show="!creatingDataBlock" @click="creatingDataBlock=true;" 
              x-text="'[Añadir Bloque de Datos de Módulo]'"></button>
      <h4 x-show="creatingDataBlock" x-text="'[Añadir Bloque de Datos de Módulo]'"></h4>
    </div>
    <div class="row align-items-end" x-show="creatingDataBlock">
      <!-- Module -->
      <stic-field-select class="col-3" x-model="newDataBlock.module" label="LBL_MODULE" map="STIC.enabledModules" map-text="text"></stic-field-select>
      <!-- Data Block name -->
      <stic-field-text class="col-3" x-model="newDataBlock.text" label="LBL_NEW_DATABLOCK_NAME" 
                       x-effect="newDataBlock.text=formConfig.suggestDataBlockText(newDataBlock.module)" 
                       keydown.enter="$('#addDataBlockModuleButton').click();" 
                       keydown.esc="$('#cancelAddDataBlockModuleButton').click();"></stic-field-text>
      <button type="button" class="btn w-32px mb-1px" id="addDataBlockModuleButton" @click="handleAddDatablockModule();">
        <span class="suitepicon suitepicon-action-confirm"></span>
      </button>
      <button type="button" class="btn w-32px mb-1px" id="cancelAddDataBlockModuleButton" @click="creatingDataBlock = false;">
        <span class="suitepicon suitepicon-action-clear"></span>
      </button>
    </div>
  </div>
  <!-- Data Blocks -->
  <div x-init="step2.loadDatablockRelationships();">
    <h2 class="mb-2" x-text="utils.translate('LBL_DATABLOCKS')"></h2>
    <div class="flex-fill border rounded p-2 overflow-auto">
      <!-- Main Content -->

      <!-- DataBlocks -->
      <template x-for="(item, key) in formConfig.data_blocks">
        <!-- DataBlock -->
        <div class="card datablock">
          <!-- DataBlock header -->
          <div class="card-header d-flex flex-column">
            <div class="d-flex justify-content-start datablock-module"> 
              <span class="mb-0 text-muted small" x-text="item.getTextDescription()"></span>
            </div>
            <div class="d-flex justify-content-between align-items-center">
              <h3 class="mb-0 me-3" :id="`dataBlockTitleEdit-${item.id}`" data-model="item.text" data-condition="item.editable_text" 
                  x-init="sticControls.editableText($el);"></h3>
              <div x-data="{
                get canMoveUp() { return item.order>0; },
                get canMoveDown() { return item.order<formConfig.data_blocks.length-1;  },
                get canRemove() { return !item.required;  },
              }">
                <div class="input-group">
                  <button type="button" class="button btn w-32px p-0 d-flex justify-content-center align-items-center" 
                          x-bind:disabled="!canMoveUp" @click="formConfig.setDataBlockOrder(item, item.order-1);">
                    <span class="suitepicon suitepicon-action-move-up"></span>
                  </button>
                  <button type="button" class="button btn w-32px p-0 d-flex justify-content-center align-items-center" 
                          x-bind:disabled="!canMoveDown" @click="formConfig.setDataBlockOrder(item, item.order+1);">
                    <span class="suitepicon suitepicon-action-move-down"></span>
                  </button>
                  <button type="button" class="button btn w-32px p-0 d-flex justify-content-center align-items-center" 
                          x-bind:disabled="!canRemove" @click="deleteDataBlock(key);">
                    <span class="suitepicon suitepicon-action-delete"></span>
                  </button>
                </div>
                <!-- <span class="btn suitepicon suitepicon-action-move-up" x-bind:disabled="!canMoveUp" @click="formConfig.setDataBlockOrder(item, item.order-1);"></span> -->
                <!-- <span class="btn suitepicon suitepicon-action-move-down" x-bind:disabled="!canMoveDown" @click="formConfig.setDataBlockOrder(item, item.order+1);"></span> -->
                <!-- <span class="btn suitepicon suitepicon-action-delete" x-bind:disabled="!canRemove" @click="deleteDataBlock(key);"></span> -->
                <!-- <p x-text="`Order: ${item.order}; CanMoveUp: ${canMoveUp}; CanMoveDown: ${canMoveDown}`"></p> -->
              </div>
            </div>
          </div>
          <!-- DataBlock body -->
          <div class="card-body">
            <!-- IEPA!!! -->
            <!-- Fer que la configuració de Camps sigui modal i que accepti qualsevol tipus de camp -->

            <!-- Fields Definition -->
            <div :id="`dataBlockFields${item.id}`" x-data="WizardStep2.creationFieldxData(item, formConfig);">
              <div class="border-bottom ps-3 pt-3 mb-2 bg-light">
                <!-- Buttons -->
                <div class="d-flex mb-3">
                  <!-- Add Unlinked Field in Form -->
                  <template x-if="!item.module">
                    <div>
                      <button type="button" class="btn w-auto" x-show="!creatingFieldUnlinked && !creatingFieldForm && !creatingFieldHidden" 
                              @click="handleStartAddField('unlinked')" x-text="utils.translate('LBL_ADD_FIELD_UNLINKED')"></button>
                      <h4 x-show="creatingFieldUnlinked" x-text="utils.translate('LBL_ADD_FIELD_UNLINKED')"></h4>
                    </div>
                  </template>
                  <!-- Add Field in Form -->
                  <template x-if="item.module">
                    <div>
                      <button type="button" class="btn w-auto" x-show="!creatingFieldUnlinked && !creatingFieldForm && !creatingFieldHidden" 
                              @click="handleStartAddField('form')" x-text="utils.translate('LBL_ADD_FIELD_FORM')"></button>
                      <h4 x-show="creatingFieldForm" x-text="utils.translate('LBL_ADD_FIELD_FORM')"></h4>
                    </div>
                  </template>
                  <!-- Add Hidden Field -->
                  <template x-if="item.module">
                    <div>
                      <button type="button" class="btn w-auto" x-show="!creatingFieldUnlinked && !creatingFieldForm && !creatingFieldHidden" 
                              @click="handleStartAddField('hidden')" x-text="utils.translate('LBL_ADD_FIELD_HIDDEN')"></button>
                      <h4 x-show="creatingFieldHidden" x-text="utils.translate('LBL_ADD_FIELD_HIDDEN')"></h4>
                    </div>
                  </template>
                </div>

                <!-- Add Unlinked Field -->
                <div x-show="creatingFieldUnlinked">
                  <form :id="`dataBlockFieldUnlinkedForm${item.id}`">
                    <div class="row align-items-end">
                      <!-- Value type -->
                      <!-- Type in form -->
                      <!-- Value options -->
                      <!-- Value Text-->
                      <!-- Label -->
                      <div class="col-3">
                        <label :for="`dbFieldU_Label${item.id}`" class="form-label"
                              x-text="utils.translateForFieldLabel('LBL_FIELD_LABEL')"></label>
                        <input :id="`dbFieldU_Label${item.id}`" type="text" class="form-control" x-model="newField.label" >
                      </div>
                      <!-- Required in form -->
                      <div class="col-2 form-switch">
                        <label :for="`dbFieldU_ReqForm${item.id}`" class="form-label"
                              x-text="utils.translateForFieldLabel('LBL_FIELD_REQUIRED_IN_FORM')"></label>
                        <input class="form-check-input form-switch" type="checkbox" role="switch"
                              :id="`dbFieldU_ReqForm${item.id}`" x-model="newField.required_in_form"/>
                      </div>
                      <!-- Buttons -->
                      <button type="button" class="btn w-32px mb-1px" x-bind:disabled="!isValid" @click="handleCreateField();">
                        <span class="suitepicon suitepicon-action-confirm"></span>
                      </button>
                      <button type="button" class="btn w-32px mb-1px" @click="handleCancel();">
                        <span class="suitepicon suitepicon-action-clear"></span>
                      </button>
                    </div>
                  </form>
                </div>

                <!-- Add Field in Form -->
                <div x-show="creatingFieldForm" x-data="WizardStep2.creationFieldInFormxData(item);">
                  <form :id="`dataBlockFieldForm${item.id}`">
                    <div class="row align-items-end">
                      <!-- Field -->
                      <div class="col-3">
                        <label :for="`dbFieldF_field${item.id}`" class="form-label"
                          x-text="utils.translateForFieldLabel('LBL_FIELD')"></label>
                        <!-- Show all fields -->
                        <div class="text-muted form-check form-switch small">
                          <label :for="`dbFieldF_field_allcheck${item.id}`" class="form-label"
                                  x-text="utils.translate('LBL_FIELDS_SHOW_ALL')"></label>
                          <input class="form-check-input form-switch" type="checkbox" role="switch"
                                  :id="`dbFieldF_field_allcheck${item.id}`" x-model="showAllFields"/>
                        </div>
                        <select :id="`dbFieldF_field${item.id}`" class="form-select" x-model="newField.name">
                          <template x-for="field in availableFields" :key="field.name">
                            <option :value="field.name" x-text="field.text"></option>
                          </template>
                        </select>
                      </div>
                      <!-- Type in form -->
                      <div class="col-2">
                        <label :for="`dbFieldF_TypeInForm${item.id}`" class="form-label"
                               x-text="utils.translateForFieldLabel('LBL_FIELD_TYPE_IN_FORM')"></label>
                        <select :id="`dbFieldF_TypeInForm${item.id}`" class="form-select" x-model="newField.type_in_form">
                          <template x-for="type in availableTypesInForm" :key="type.id">
                            <option :value="type.id" x-text="type.text"></option>
                          </template>
                        </select>
                      </div>
                      <!-- Subtype in form -->
                      <div class="col-2">
                        <label :for="`dbFieldF_SubtypeInForm${item.id}`" class="form-label"
                               x-text="utils.translateForFieldLabel('LBL_FIELD_SUBTYPE_IN_FORM')"></label>
                        <select :id="`dbFieldF_SubtypeInForm${item.id}`" class="form-select" x-model="newField.subtype_in_form">
                          <template x-for="type in availableSubtypesInForm" :key="type.id">
                            <option :value="type.id" x-text="type.text"></option>
                          </template>
                        </select>
                      </div>
                      <!-- Value options list name -->
                      <template x-if="newField.acceptValueOptions()">
                        <div class="col-5">
                          <label :for="`dbFieldF_ValueOptionsDesc${item.id}`" class="form-label"
                                  x-text="utils.translateForFieldLabel('LBL_FIELD_VALUE_OPTIONS_LIST')"></label>
                          <!-- Value options configuration Check -->
                          <div class="text-muted form-check form-switch small">
                            <label :for="`dbFieldF_ValueOptionsConf${item.id}`" class="form-label"
                                   x-text="utils.translate('LBL_FIELD_VALUE_OPTIONS_CUSTOMIZE')"></label>
                            <input class="form-check-input form-switch" type="checkbox" role="switch"
                                   :id="`dbFieldF_ValueOptionsConf${item.id}`" x-model="configValueOptions"/>
                          </div>
                          <input :id="`dbFieldF_ValueOptionsDesc${item.id}`" type="text" disabled class="form-control"
                                  x-model="optionValuesListNameModified" >
                        </div>
                      </template>
                    </div>
                    <!-- Value options -->
                    <template x-if="configValueOptions">
                      <div class="row">
                        <!-- Value options configuration Table -->
                        <div class="col-12" x-data="WizardStep2.sortableListxData(newField.value_options)">
                          <table class="table table-bordered table-striped w-auto"
                                 :id="`dbFieldF_ValueOptionsTable${item.id}`" >
                            <caption class="form-label" x-text="utils.translateForFieldLabel('LBL_FIELD_VALUE_OPTIONS')"></caption>
                            <thead>
                              <tr>
                                <th x-text="'[Id]'"></th>
                                <th x-text="'[Texto original]'"></th>
                                <th x-text="'[Mostrar]'"></th>
                                <th x-text="'[Texto en el formulario]'"></th>
                                <th x-text="'[Acción]'"></th>
                              </tr>
                            </thead>
                            <tbody>
                              <template x-for="(element, index) in newField.value_options">
                                <tr>
                                  <td x-text="element.value"></td>
                                  <td x-text="element.text_original"></td>
                                  <td> 
                                    <div class="form-switch">
                                      <input class="form-check-input form-switch" type="checkbox" role="switch" x-model="element.is_visible"
                                             :id="`dbFieldF_ValueOptionsInclude${index}${item.id}`"/>
                                    </div>
                                  </td>
                                  <td>
                                    <input class="form-control" type="text" x-model="element.text"
                                           :id="`dbFieldF_ValueOptionsText${index}${item.id}`"/>
                                  </td>
                                  <td>
                                    <button type="button" class="btn btn-sm btn-outline-primary me-2" :disabled="index === 0" @click="moveUp(index)">
                                      ⬆️
                                    </button>
                                    <button type="button" class="btn btn-sm btn-outline-primary" :disabled="index === newField.value_options.length - 1" @click="moveDown(index)">
                                      ⬇️
                                    </button>
                                  </td>
                                </tr>
                              </template> 
                            </tbody>
                          </table>
                        </div>
                      </div> 
                    </template>
                    <div class="row align-items-end">
                      <!-- Label -->
                      <div class="col-3">
                        <label :for="`dbFieldF_Label${item.id}`" class="form-label"
                              x-text="utils.translateForFieldLabel('LBL_FIELD_LABEL')"></label>
                        <input :id="`dbFieldF_Label${item.id}`" type="text" class="form-control" x-model="newField.label" >
                      </div>

                      <!-- Placeholder -->
                      <template x-if="newField.acceptPlaceholder()">
                        <div class="col-3">
                          <label :for="`dbFieldF_Placeholder${item.id}`" class="form-label"
                                x-text="utils.translateForFieldLabel('LBL_FIELD_PLACEHOLDER')"></label>
                          <input :id="`dbFieldF_Placeholder${item.id}`" type="text" class="form-control" x-model="newField.placeholder" >
                        </div>
                      </template>

                      <!-- Required in form -->
                      <div class="col-3 form-switch">
                        <label :for="`dbFieldF_ReqForm${item.id}`" class="form-label"
                              x-text="utils.translateForFieldLabel('LBL_FIELD_REQUIRED_IN_FORM')"></label>
                        <input class="form-check-input form-switch" type="checkbox" role="switch"
                              :id="`dbFieldF_ReqForm${item.id}`" x-model="newField.required_in_form"/>
                      </div>
                      <!-- Buttons -->
                      <button type="button" class="btn w-32px mb-1px" x-bind:disabled="!isValid" @click="handleCreateField();">
                        <span class="suitepicon suitepicon-action-confirm"></span>
                      </button>
                      <button type="button" class="btn w-32px mb-1px" @click="handleCancel();">
                        <span class="suitepicon suitepicon-action-clear"></span>
                      </button>
                    </div>
                  </form>
                </div>

                <!-- Add Hidden Field -->
                <div x-show="creatingFieldHidden" x-data="WizardStep2.creationFieldHiddenxData(item);">
                  <form :id="`dataBlockFieldHiddenForm${item.id}`">
                    <div class="row align-items-end">
                      <!-- Field -->
                      <div class="col-3">
                        <label :for="`dbFieldH_field${item.id}`" class="form-label"
                          x-text="utils.translateForFieldLabel('LBL_FIELD')"></label>
                        <!-- Show all fields -->
                        <div class="text-muted form-check form-switch small">
                          <label :for="`dbFieldH_field_allcheck${item.id}`" class="form-label"
                                  x-text="utils.translate('LBL_FIELDS_SHOW_ALL')"></label>
                          <input class="form-check-input form-switch" type="checkbox" role="switch"
                                  :id="`dbFieldH_field_allcheck${item.id}`" x-model="showAllFields"/>
                        </div>
                        <select :id="`dbFieldH_field${item.id}`" class="form-select" x-model="newField.name">
                          <template x-for="field in availableFields" :key="field.name">
                            <option :value="field.name" x-text="field.text"></option>
                          </template>
                        </select>
                      </div>
                      <!-- Value type -->
                      <div class="col-2">
                        <label :for="`dbFieldH_ValueType${item.id}`" class="form-label"
                              x-text="utils.translateForFieldLabel('LBL_FIELD_VALUE_TYPE')"></label>
                        <select :id="`dbFieldH_ValueType${item.id}`" class="form-select" x-model="newField.value_type">
                          <template x-for="type in availableValueTypes" :key="type.id">
                            <option :value="type.id" x-text="type.text"></option>
                          </template>
                        </select>
                      </div>
                      <!-- Value (fixed value of enum) -->
                      <template x-if="hasOptions">
                        <div class="col-3">
                          <label :for="`dbFieldH_ValFixOptions${item.id}`" class="form-label"
                                x-text="utils.translateForFieldLabel('LBL_FIELD_VALUE')"></label>
                          <select :id="`dbFieldH_ValFixOptions${item.id}`" class="form-select" x-model="newField.value">
                            <template x-for="option in optionValues" :key="option.id">
                              <option :value="option.id" x-text="option.text"></option>
                            </template>
                          </select>
                        </div>
                      </template>
                      <!-- Value (fixed value of related) -->
                      <template x-if="isRelated && newField.value_type=='fixed'">
                        <div class="col-3">
                          <label :for="`dbFieldH_ValFixRel_name${item.id}`" class="form-label"
                                x-text="utils.toFieldLabelText(selectedFieldInfo?.text??'')"></label>
                          <div class="input-group">
                            <input class="form-control" type="text" :id="`dbFieldH_ValFixRel_name${item.id}`" x-model="newField.value_text" 
                                  autocomplete="off" readonly style="background-color:rgb(255, 255, 255);" />
                            <input type="hidden" :id="`dbFieldH_ValFixRel_id${item.id}`" x-model="newField.value" />
                            <button class="btn" type="button" @click="openPopUp('dbField_ValFixRel')">
                              <span class="suitepicon suitepicon-action-select"></span>
                            </button>
                            <button class="btn" type="button" @click="newField.value='';newField.value_text='';">
                              <span class="suitepicon suitepicon-action-clear"></span>
                            </button>
                          </div>
                        </div>
                      </template>
                      <!-- Value (fixed value of date) -->
                      <template x-if="isDate">
                        <div class="col-3">
                          <label :for="`dbFieldH_ValFixDate${item.id}`" class="form-label"
                                x-text="utils.translateForFieldLabel('LBL_FIELD_VALUE')"></label>
                          <div class="form-switch">
                            <label :for="`dbFieldH_ValFixDate_Today${item.id}`" class="form-label"
                                    x-text="utils.translateForFieldLabel('LBL_FIELD_VALUE_TODAY')"></label>
                            <input class="form-check-input form-switch" type="checkbox" role="switch"
                                  :id="`dbFieldH_ValFixDate_Today${item.id}`" x-model="valueToday"/>
                          </div>
                          <input :id="`dbFieldH_ValFixDate${item.id}`" type="date" class="form-control" autocomplete="off" 
                                :disabled="valueToday" x-model="newField.value"/>
                        </div>
                      </template>
                      <!-- Value (fixed value) -->
                      <template x-if="!hasOptions && !isRelated && !isDate">
                        <div class="col-3">
                          <label :for="`dbFieldH_ValFixText${item.id}`" class="form-label"
                                x-text="utils.translateForFieldLabel('LBL_FIELD_VALUE')"></label>
                          <input :id="`dbFieldH_ValFixText${item.id}`" type="text" class="form-control"  autocomplete="off"
                                x-model="newField.value"/>
                        </div>
                      </template>

                      <!-- Buttons -->
                      <button type="button" class="btn w-32px mb-1px" x-bind:disabled="!isValid" @click="handleCreateField();">
                        <span class="suitepicon suitepicon-action-confirm"></span>
                      </button>
                      <button type="button" class="btn w-32px mb-1px" @click="handleCancel();">
                        <span class="suitepicon suitepicon-action-clear"></span>
                      </button>
                    </div>
                  </form>
                </div>
              </div>

              <!-- Fields summary Tabs -->
              <!-- Fields Details -->
              <div>
                <!-- All Fields -->
                <div :id="`dataBlockFieldsAll${item.id}`" class="overflow-auto">
                  [Todos los campos del Bloque de datos]
                  <div class="mt-3" :id="`dataFieldsTableAll${item.id}`" :data-objects="'item.fields'" x-init="sticControls.elemTableObjects($el);"></div>
                </div>
                <!-- Fields in Form -->
                <template x-if="item.module">
                  <div :id="`dataBlockFieldsForm${item.id}`" class="overflow-auto">
                    [Los campos en el formulario del Bloque de datos] 
                    <div class="mt-3" :id="`dataFieldsTableForm${item.id}`" :data-objects="'item.fields.filter(f => f.isFieldInForm())'" x-init="sticControls.elemTableObjects($el);"></div>
                  </div>
                </template>
                <!-- Hidden Fields -->
                <template x-if="item.module">
                  <div :id="`dataBlockFieldsHidden${item.id}`"  class="overflow-auto">
                    [Los campos Ocultos del Bloque de datos] 
                    <div class="mt-3" :id="`dataFieldsTableHidden${item.id}`" :data-objects="'item.fields.filter(f => !f.isFieldInForm())'" x-init="sticControls.elemTableObjects($el);"></div>
                  </div>
                </template>

                <!-- Tab Headers -->
                <template x-if="item.module">
                  <div :id="`dataBlockFieldsTabs${item.id}`"
                        :data-sections="JSON.stringify([
                                      {headerText:`utils.translate('LBL_FIELDS_ALL') + ' ('+item.fields.length+')'`, selected:true, contentId:'dataBlockFieldsAll'+item.id},
                                      {headerText:`utils.translate('LBL_FIELDS_FORM') + ' ('+item.fields.filter(f => f.isFieldInForm()).length+')'`, selected:false, contentId:'dataBlockFieldsForm'+item.id},
                                      {headerText:`utils.translate('LBL_FIELDS_HIDDEN') + ' ('+item.fields.filter(f => !f.isFieldInForm()).length+')'`, selected:false, contentId:'dataBlockFieldsHidden'+item.id},
                                      ]);"
                      x-init="sticControls.tabs($el)">
                  </div>
                </template>
              </div>
            </div>
            <!-- Duplicate Definition -->
            <template x-if="item.module">
              <div :id="`dataBlockDuplicates${item.id}`">
                <div class="row">
                  <!-- Action -->
                  <div class="col-3" :id="`duplicateAction${item.id}`" :data-model="'item.duplicate_detection.on_duplicate'" data-label="LBL_ONDUPLICATE_ACTION"
                        :data-map="utils.getList('stic_advanced_web_forms_datablocks_duplicate_action_list', true)" x-init="sticControls.fieldSelect($el)"></div>
                  <!-- Fields -->
                  <div class="col-9" :id="`duplicateFields${item.id}`" :data-model="'item.duplicate_detection.fields'" data-label="LBL_DUPLICATE_FIELDS"
                        :data-map="`utils.getModuleInformation('${item.module}').fields`" data-map-property="text" data-multiple
                        x-init="sticControls.fieldSelect($el)"></div>
                </div>
              </div>
            </template>
            <!-- Relationships Definition -->
            <template x-if="item.module">
              <div :id="`dataBlockRels${item.id}`">
                [Las relaciones del Bloque de datos]
                  <!-- Relationships Details -->
                <div x-data="{ showRelationshipsTable: false}">
                  <div class="text-muted form-check form-switch mt-3" :id="`dataRelationshipsDetails${item.id}`"
                        data-model="showRelationshipsTable" data-label-text="[Mostrar Detalles]" x-init="sticControls.fieldCheckbox($el);"></div>
                  <div class="card p-2 overflow-auto" x-show="showRelationshipsTable">
                    <div class="mt-3" :id="`dataBlockRelsTable${item.id}`"
                          :data-objects="`step2.usedDatablockRelationships('${item.id}')`" x-init="sticControls.elemTableObjects($el);"></div>
                  </div>
                </div>
                <!-- Add Relationship -->
                <div class="border-bottom ps-3 pt-3 mb-2 bg-light" x-data="WizardStep2.addRelationshipxData(item, formConfig, step2);">
                  <div class="row">
                    <button type="button" class="btn w-auto" x-show="!creatingRelDataBlock" @click="loadRelations()"
                            x-text="'[Añadir Relación con otro Bloque de Datos]'"></button>
                    <h4 x-show="creatingRelDataBlock" x-text="'[Añadir Relación con otro Bloque de Datos]'"></h4>
                  </div>
                  <div class="row align-items-end" x-show="creatingRelDataBlock">
                    <!-- Relationship -->
                    <div class="col-3">
                      <label :for="`dataBlockRelsEdit${item.id}_Rel_select`" class="form-label"
                            x-text="utils.translateForFieldLabel('LBL_RELATIONSHIP')"></label>
                      <select :id="`dataBlockRelsEdit${item.id}_Rel_select`" class="form-select" x-model="selectedRelName" @change="handleRelationChange()">
                        <template x-for="relation in availableRels" :key="relation.name">
                          <option :value="relation.name" x-text="relation.textExtended"></option>
                        </template>
                      </select>
                    </div>
                    <!-- Data Block -->
                    <div class="col-3">
                      <label :for="`dataBlockRelsEdit${item.id}_DataBlock_select`" class="form-label"
                            x-text="utils.translateForFieldLabel('LBL_DATABLOCK')"></label>
                      <select :id="`dataBlockRelsEdit${item.id}_DataBlock_select`" class="form-select" x-model="selectedDataBlockId" @change="handleDataBlockChange()">
                        <template x-for="dataBlock in availableDataBlocks" :key="dataBlock.id">
                          <option :value="dataBlock.id" x-text="dataBlock.text"></option>
                        </template>
                      </select>
                    </div>
                    <!-- New Data Block -->
                    <div class="col-3" x-show="relNewDataBlock">
                      <label :for="`dataBlockRelsEdit${item.id}_NewDataBlock_input`" class="form-label"
                              x-text="utils.translateForFieldLabel('LBL_NEW_DATABLOCK_NAME')"></label>
                      <input :id="`dataBlockRelsEdit${item.id}_NewDataBlock_input`" type="text" class="form-control" x-model="newDataBlockText" >
                    </div>
                    <button type="button" class="btn w-32px mb-1px" @click="handleCreateRelationship();">
                      <span class="suitepicon suitepicon-action-confirm"></span>
                    </button>
                    <button type="button" class="btn w-32px mb-1px" @click="creatingRelDataBlock = false;">
                      <span class="suitepicon suitepicon-action-clear"></span>
                    </button>
                  </div>
                </div>
              </div>
            </template>

            <!-- Accordion Headers -->
            <template x-if="!item.module">
              <div :id="`dataDef_${item.id}`"
                    :data-sections="JSON.stringify([
                              {headerText:`utils.translate('LBL_FIELDS') + ' ('+item.fields.filter(f => f.isFieldInForm()).length+')'`, selected:true, contentId:'dataBlockFields'+item.id},
                              ]);"
                    x-init="sticControls.accordion($el)"></div>
            </template>
            <template x-if="item.module">
              <div :id="`dataDef_${item.id}`"
                    :data-sections="JSON.stringify([
                              {headerText:`utils.translate('LBL_FIELDS') + ' ('+item.fields.filter(f => f.isFieldInForm()).length+')'`, selected:true, contentId:'dataBlockFields'+item.id},
                              {headerText:`utils.translate('LBL_DUPLICATE_CHECK') + ' ('+item.duplicate_detection.fields.length+' - '+item.duplicate_detection.on_duplicate+')'`, selected:false, contentId:'dataBlockDuplicates'+item.id},
                              {headerText:`utils.translate('LBL_RELATIONSHIPS')`, selected:false, contentId:'dataBlockRels'+item.id},
                              ]);"
                    x-init="sticControls.accordion($el)"></div>
            </template>
          </div>
        </div>
      </template>
    </div>
  </div>
  <!-- Details Data [DEBUG] -->
  <div x-data="{ showDetails: false}">
    <div class="text-muted form-check form-switch mb-3 mt-5" id="showDetailsDataToggleSwitch" data-model="showDetails" data-label-text="[Mostrar Detalles]"
         x-init="sticControls.fieldCheckbox($el);"></div>
    <div class="card p-2" x-show="showDetails">
      <!-- Data Blocks -->
      <div id="detailsDataBlocks">
        <div class="mt-3" id="dataBlocksTable" data-objects="formConfig.data_blocks" x-init="sticControls.elemTableObjects($el);"></div>
      </div>
      <!-- Relationships -->
      <div id="detailsRelationships">
        <div class="mt-3" id="relationshipsTable" data-objects="step2.allDatablockRelationships" data-model="step2.allDatablockRelationships"
        x-init="sticControls.elemListObject($el);"></div>
      </div>
      <!-- Tab Headers -->
      <div id="details"
           :data-sections="JSON.stringify([
                            {headerText:`'[Bloques de datos]'`, selected:true, contentId:'detailsDataBlocks'},
                            {headerText:`'[Relaciones]'`, selected:false, contentId:'detailsRelationships'},
                          ]);"
           x-init="sticControls.tabs($el)"></div>
    </div>
  </div>
</main>
