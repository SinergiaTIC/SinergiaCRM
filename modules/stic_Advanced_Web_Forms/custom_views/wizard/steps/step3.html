<!-- Main Panel -->
<main class="wizard-main flex-fill d-flex flex-column" x-data="WizardStep3.mainStep3xData();">
    <!-- Flows -->
    <div class="flex-fill border rounded p-2 overflow-auto">
        <h2 class="mb-2" x-text="utils.translate('LBL_FLOWS')"></h2>
        <!-- Show all Actions -->
        <div class="text-muted form-check form-switch small p-3" x-init="utils.setInlineHelpQtip()">
            <label for="actions_allcheck" class="form-label" x-text="utils.translate('LBL_ACTIONS_SHOW_ALL')"></label>
            <i class="inline-help glyphicon glyphicon-info-sign"></i>
            <div class="inline-help-content" style="display:none;" x-text="utils.translate('LBL_ACTIONS_SHOW_ALL_DESC')"></div>
            <input class="form-check-input form-switch" type="checkbox" role="switch" id="actions_allcheck" x-model="showAllActions"/>
        </div>
        <!-- Tab Headers: Flows -->
        <div class="stic-tabs">
            <template x-for="flow in formConfig.flows" :key="flow.id">
                <div class="stic-tab">
                    <input class="form-check-input" type="radio" :id="`flowTab${flow.id}`" x-model="flowTabSelected" :value="`${flow.id}`"/>
                    <label class="form-label" :for="`flowTab${flow.id}`" x-text="flow.getText()"></label>
                </div>
            </template>
        </div>
        <!-- Tab Content: Flows -->
        <div class="stic-tabcontent">
            <!-- Actions -->
            <div class="accordion">
                <template x-for="action in actions" :key="action.id">
                    <div class="accordion-item" x-data="{opened:false}" x-show="action.is_user_selectable || showAllActions">
                        <div :id="action.id+'_Header'" 
                             class="accordion-header accordion-button p-0 align-items-center"
                             :class="{'collapsed': !opened}">
                            <div class="d-flex flex-grow-1 align-items-center py-3 ps-3 pe-2"
                                 role="button"
                                 @click="opened = !opened"
                                 data-bs-toggle="collapse" 
                                 :data-bs-target="'#'+action.id+'_Content'" 
                                 :aria-controls="action.id+'_Content'">
                                <div class="fw-bold text-truncate" style="max-width: 30%;">
                                    <span :id="`actionTextEdit-${action.id}`" data-model="action.text" x-init="sticControls.editableText($el);"></span>
                                </div>
                                <div class="text-muted small text-truncate px-2" style="flex: 1; text-align: center;">
                                    <span x-text="action.description"></span>
                                </div>
                            </div>
                            <!-- Buttons -->
                            <div class="d-flex align-items-center pe-3">
                                <div class="d-inline-flex input-group" role="group">
                                    <button type="button" class="btn" :title="utils.translate('LBL_BUTTON_MOVE_UP')"
                                            :disabled="!canMoveUpAction(action);" @click="moveUpAction(action);">
                                        <span class="suitepicon suitepicon-action-move-up"></span>
                                    </button>
                                    <button type="button" class="btn" :title="utils.translate('LBL_BUTTON_MOVE_DOWN')"
                                            :disabled="!canMoveDownAction(action);" @click="moveDownAction(action);">
                                        <span class="suitepicon suitepicon-action-move-down"></span>
                                    </button>
                                </div> 
                            </div>
                        </div>
                        <div :id="action.id+'_Content'" class="accordion-collapse collapse" :aria-labelledby="action.id+'_Header'">
                            <div :id="action.id+'_Body'" class="accordion-body"> 
                                <!-- Action details-->
                                <table class="table table-bordered align-middle" >
                                    <colgroup>
                                        <col style="width:30%">
                                        <col style="width:20%">
                                        <col style="width:40%">
                                        <col style="width:10%">
                                    </colgroup>
                                    <thead class="table-light">
                                        <tr>
                                            <th x-text="utils.translate('LBL_ACTION_NAME')"></th>
                                            <th x-text="utils.translate('LBL_ACTION_CATEGORY')"></th>
                                            <th x-text="utils.translate('LBL_ACTION_PARAMETERS')"></th>
                                            <th x-text="utils.translate('LBL_ACTION_ACTIONS')"></th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <!-- Name -->
                                            <td><strong :id="`actionTextEdit-${action.id}`" data-model="action.text" x-init="sticControls.editableText($el);"></strong></td>
                                            <!-- Category -->
                                            <td x-text="action.category_in_formText"></td>
                                            <!-- Parameters -->
                                            <td rowspan="2" class="p-0">
                                                <table class="table table-sm mb-0">
                                                    <tbody>
                                                        <template x-for="param in action.parameters" :key="param.name">
                                                            <tr>
                                                                <th class="w-25" x-text="param.text"></th>
                                                                <td x-text="param.value_text"></td>
                                                            </tr>
                                                        </template>
                                                    </tbody>
                                                </table>
                                            </td>
                                            <!-- Buttons -->
                                            <td>
                                                <button type="button" class="btn" :title="utils.translate('LBL_BUTTON_EDIT')"
                                                        :disabled="!canEditAction(action);" @click="$store.actionEditor.openEdit(action);">
                                                    <span class="suitepicon suitepicon-action-edit"></span>
                                                </button>
                                                <button type="button" class="btn ms-2" :title="utils.translate('LBL_BUTTON_DELETE')"
                                                        :disabled="!canRemoveAction(action);" @click="removeAction(action);">
                                                    <span class="suitepicon suitepicon-action-delete"></span>
                                                </button>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td colspan="2" class="text-muted small" x-text="action.description"></td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>                        
                    </div>
                </template>
            </div>
            <!-- Create Action Button -->
            <div class="row mb-3">
                <button type="button" class="btn w-auto" x-text="utils.translate('LBL_ACTION_ADD')"></button>
                <!-- <button type="button" class="btn w-auto" @click="$store.fieldEditor.openCreate(item, 'form')" x-text="utils.translate('LBL_ACTION_ADD')"></button> -->
            </div>
        </div>
    </div>

    <!-- Modal: Create Action -->
    <div x-show="creatingAction" x-cloak class="custom-modal-wrapper">
        <div class="custom-modal-backdrop"></div>
        <div class="custom-modal-dialog" role="dialog" aria-modal="true" aria-labelledby="modalCreateAction">
            <div class="custom-modal-content">
                <div class="custom-modal-header">
                    <h3 class="modal-title" id="modalCreateAction" x-text="utils.translate('LBL_ACTION_NEW')"></h3>
                    <button type="button" class="btn-close" @click="creatingAction = false;"></button>
                </div>
                <div class="custom-modal-body">
                    <form id="newActionModalForm">
                        <div class="row align-items-end">
                            <!-- Flow -->
                            <div class="col-3">
                                <label for="modalCreateAction_flow" class="form-label" x-text="utils.translateForFieldLabel('LBL_FLOW')"></label>
                                <select id="modalCreateAction_flow" class="form-select" x-model="newAction.flow">
                                    <template x-for="flow in formConfig.flows" :key="flow.id">
                                        <option :value="flow.id" x-text="flow.getText()"></option>
                                    </template>
                                </select>
                            </div>

                            <!-- Module -->
                            <stic-field-select class="col-3" x-model="newDataBlock.module" label="LBL_MODULE" map="STIC.enabledModules" map-text="text"></stic-field-select>
                            <!-- Data Block name -->
                            <stic-field-text class="col-3" x-model="newDataBlock.text" label="LBL_DATABLOCK_NEW" 
                                            x-effect="newDataBlock.text=formConfig.suggestDataBlockText(newDataBlock.module)"
                                            keydown.esc="$('#cancelAddDataBlockModuleButton').click();"></stic-field-text>
                        </div>
                    </form>
                </div>

                <!-- Accept / Cancel Buttons -->
                <div class="custom-modal-footer">
                    <button type="button" class="col-2 btn btn-secondary" id="cancelAddDataBlockModuleButton" @click="creatingAction = false;" 
                            x-text="utils.translate('LBL_CANCEL_BUTTON_LABEL');"></button>
                    <button type="button" class="col-2 btn btn-primary" id="addDataBlockModuleButton" @click="handleAddDatablockModule();"
                            x-bind:disabled="!isValid" x-text="utils.translate('LBL_SAVE_BUTTON_LABEL');"></button>
                </div>
            </div>
        </div>
    </div>
</main>
